<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Project Implementation GCP | FMISD13207 Cloud Security Technologies</title>
  <meta name="description" content="Chapter 4 Project Implementation GCP | FMISD13207 Cloud Security Technologies" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Project Implementation GCP | FMISD13207 Cloud Security Technologies" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Project Implementation GCP | FMISD13207 Cloud Security Technologies" />
  
  
  

<meta name="author" content="Kęstutis Daugėla" />


<meta name="date" content="2022-06-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="project-scope.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Information Security Technologies</a></li>

<li class="divider"></li>
<li><a href="index.html#introduction">Introduction<span></span></a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>0.1</b> Cloud Computing<span></span></a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#data-breach---case-study"><i class="fa fa-check"></i><b>0.2</b> Data Breach - Case Study<span></span></a>
<ul>
<li class="chapter" data-level="0.2.1" data-path="index.html"><a href="index.html#twitch"><i class="fa fa-check"></i><b>0.2.1</b> Twitch<span></span></a></li>
<li class="chapter" data-level="0.2.2" data-path="index.html"><a href="index.html#phizer"><i class="fa fa-check"></i><b>0.2.2</b> Phizer<span></span></a></li>
<li class="chapter" data-level="0.2.3" data-path="index.html"><a href="index.html#citybee"><i class="fa fa-check"></i><b>0.2.3</b> Citybee<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html"><i class="fa fa-check"></i><b>1</b> Cloud Cybersecurity Management<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html#cloud-security-overview"><i class="fa fa-check"></i><b>1.1</b> Cloud Security Overview<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html#infrastructure-as-code"><i class="fa fa-check"></i><b>1.2</b> Infrastructure as Code<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html#type-of-threats"><i class="fa fa-check"></i><b>1.3</b> Type of threats<span></span></a></li>
<li class="chapter" data-level="1.4" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html#vulnerabilities"><i class="fa fa-check"></i><b>1.4</b> Vulnerabilities<span></span></a></li>
<li class="chapter" data-level="1.5" data-path="cloud-cybersecurity-management.html"><a href="cloud-cybersecurity-management.html#risks"><i class="fa fa-check"></i><b>1.5</b> Risks<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="paper-review.html"><a href="paper-review.html"><i class="fa fa-check"></i><b>2</b> Paper review<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="paper-review.html"><a href="paper-review.html#security-challenges-in-different-network-layers"><i class="fa fa-check"></i><b>2.1</b> Security Challenges in Different Network Layers<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="paper-review.html"><a href="paper-review.html#anomaly-detection-for-cloud-applications"><i class="fa fa-check"></i><b>2.2</b> Anomaly detection for Cloud Applications<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="project-scope.html"><a href="project-scope.html"><i class="fa fa-check"></i><b>3</b> Project Scope<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="project-scope.html"><a href="project-scope.html#platform-for-anatical-applications"><i class="fa fa-check"></i><b>3.1</b> Platform for anatical applications<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="project-scope.html"><a href="project-scope.html#kubernetes-and-docker"><i class="fa fa-check"></i><b>3.2</b> Kubernetes and Docker<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="project-scope.html"><a href="project-scope.html#shiny-server-security-experiment"><i class="fa fa-check"></i><b>3.3</b> Shiny Server Security Experiment<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="project-scope.html"><a href="project-scope.html#security-considerations"><i class="fa fa-check"></i><b>3.4</b> Security considerations<span></span></a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="project-scope.html"><a href="project-scope.html#data-encryption"><i class="fa fa-check"></i><b>3.4.1</b> Data Encryption<span></span></a></li>
<li class="chapter" data-level="3.4.2" data-path="project-scope.html"><a href="project-scope.html#single-sign-on"><i class="fa fa-check"></i><b>3.4.2</b> Single Sign On<span></span></a></li>
<li class="chapter" data-level="3.4.3" data-path="project-scope.html"><a href="project-scope.html#network"><i class="fa fa-check"></i><b>3.4.3</b> Network<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html"><i class="fa fa-check"></i><b>4</b> Project Implementation GCP<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#shiny-application"><i class="fa fa-check"></i><b>4.1</b> Shiny Application<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#containerization"><i class="fa fa-check"></i><b>4.2</b> Containerization<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#terraform"><i class="fa fa-check"></i><b>4.2.1</b> Terraform<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#cloud-run"><i class="fa fa-check"></i><b>4.2.2</b> Cloud Run<span></span></a></li>
<li class="chapter" data-level="4.2.3" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#gke"><i class="fa fa-check"></i><b>4.2.3</b> GKE<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#shiny-r-applications"><i class="fa fa-check"></i><b>4.3</b> Shiny R Applications<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#security-measures"><i class="fa fa-check"></i><b>4.4</b> Security Measures<span></span></a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#load-balancing"><i class="fa fa-check"></i><b>4.4.1</b> Load balancing<span></span></a></li>
<li class="chapter" data-level="4.4.2" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#dns"><i class="fa fa-check"></i><b>4.4.2</b> DNS<span></span></a></li>
<li class="chapter" data-level="4.4.3" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#certificates"><i class="fa fa-check"></i><b>4.4.3</b> Certificates<span></span></a></li>
<li class="chapter" data-level="4.4.4" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#identity-aware-proxy"><i class="fa fa-check"></i><b>4.4.4</b> Identity aware proxy<span></span></a></li>
<li class="chapter" data-level="4.4.5" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#audit"><i class="fa fa-check"></i><b>4.4.5</b> Audit<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="project-implementation-gcp.html"><a href="project-implementation-gcp.html#final-result"><i class="fa fa-check"></i><b>4.5</b> Final result<span></span></a></li>
</ul></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li>Vilnius Tech 2022</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">FMISD13207 Cloud Security Technologies</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="project-implementation-gcp" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Project Implementation GCP<a href="project-implementation-gcp.html#project-implementation-gcp" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="shiny-application" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Shiny Application<a href="project-implementation-gcp.html#shiny-application" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Several shiny R applications were created for this project. The authentication part could be either shifted for the identity aware proxy or implemented in the application, as in example below.</p>
<pre><code>library(shiny)
library(googleAuthR)
gar_set_client(activate=&quot;web&quot;, web_json = &quot;client.json&quot;, scopes = &quot;https://www.googleapis.com/auth/webmasters&quot;)
ui &lt;- fluidPage( 
  titlePanel(&quot;Sample Google Sign-In&quot;),  
  sidebarLayout(
    sidebarPanel(
      googleSignInUI(&quot;demo&quot;)
    ),    
    mainPanel(
      h3(&quot;test&quot;),
      with(tags, dl(dt(&quot;Name&quot;), dd(textOutput(&quot;g_name&quot;)),
                    dt(&quot;Email&quot;), dd(textOutput(&quot;g_email&quot;)),
                    dt(&quot;Image&quot;), dd(uiOutput(&quot;g_image&quot;)) ))
    )
  )
)
server &lt;- function(input, output, session) {  
  sign_ins &lt;- shiny::callModule(googleSignIn, &quot;demo&quot;)
  output$g_name = renderText({ sign_ins()$name })
  output$g_email = renderText({ sign_ins()$email })
  output$g_image = renderUI({ img(src=sign_ins()$image) })  
}
shinyApp(ui = ui, server = server)</code></pre>
<p>While Shiny application could be hosted with the default config on any VM, websockets needs to be disabled for running shiny Google Cloud Run.</p>
<pre><code>disable_protocols websocket xdr-streaming xhr-streaming iframe-eventsource iframe-htmlfile xdr-polling iframe-xhr-polling;
run_as shiny;
server {
  listen 8080;
  location / {
    site_dir /srv/shiny-server;
    log_dir /var/log/shiny-server;
    directory_index off;
  }
}</code></pre>
</div>
<div id="containerization" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Containerization<a href="project-implementation-gcp.html#containerization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to dockerize shiny application, we will be using a docker image from rocker repository. Since the image is packaged with all the dependencies, we only need to add dependend packages (“googleAuthR”) and move required files to the container (shiny server configuration, client secret and the application itself).</p>
<pre><code>FROM rocker/shiny
RUN apt-get update &amp;&amp; apt-get install -y \
libcurl4-openssl-dev libssl-dev \
&amp;&amp; apt-get clean \
&amp;&amp; rm -rf /var/lib/apt/lists/ \
&amp;&amp; rm -rf /tmp/downloaded_packages/ /tmp/*.rds
RUN install2.r --error \
    -r &#39;http://cran.rstudio.com&#39; \
    googleAuthR
COPY shiny-customized.config /etc/shiny-server/shiny-server.conf
COPY client.json /srv/shiny-server/client.json
COPY app.R /srv/shiny-server/app.R
RUN chmod -R 775 /srv/shiny-server/
EXPOSE 8080
USER shiny
CMD [&quot;/usr/bin/shiny-server&quot;]</code></pre>
<p>In order to build a docker container and push the image to the Google Container registry, these commands are utilized. It is possible to automate the pipeline and build container from source (e.g. project github repository), but this feature was outside the scope of the project.</p>
<pre><code>gcloud auth login --project {project id}
PROJECTID=$(gcloud config get-value project)
docker build . -t gcr.io/$PROJECTID/signin
docker push gcr.io/$PROJECTID/signin</code></pre>
<p>For debugging purposes, application can be launched locally:</p>
<pre><code>docker run --rm -p 8080:8080 gcr.io/$PROJECTID/simpleauth:latest</code></pre>
<div id="terraform" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Terraform<a href="project-implementation-gcp.html#terraform" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since we are following Infrastructure as Code pattern, the whole required infrastructure could be defined in a terraform file. We need to select project, region, service and add application deployment config. In case of Cloud Run deployment, terraform file can be defined like this:</p>
<p>cloudrun-shiny.tf</p>
<pre><code>provider &quot;google&quot;{
 project     = &quot;shiny-cloud-project&quot;
 region      = &quot;europe-west1&quot;
}

resource &quot;google_project_service&quot; &quot;run&quot; {
  service = &quot;run.googleapis.com&quot;
}

resource &quot;google_cloud_run_service&quot; &quot;shiny-simple-signin&quot; {
  name = &quot;shiny-simple-signin&quot;
  location = &quot;europe-west1&quot;
  template {
    spec {
      containers {
        image = &quot;gcr.io/shiny-cloud-project/signin:latest&quot;
        resources {
          limits = {
            cpu = &quot;1000m&quot;
            memory = &quot;1024Mi&quot;
          }
        }
        ports {
          container_port = 8080
        }
      }
      container_concurrency = 80
      timeout_seconds = 300
    }
    metadata {
      annotations = {
        &quot;autoscaling.knative.dev/minScale&quot; = 0
        &quot;autoscaling.knative.dev/maxScale&quot; = 1
      }
    }
  }
  traffic {
    percent = 100
    latest_revision = true
  }
  depends_on = [google_project_service.run]
}

resource &quot;google_cloud_run_service_iam_member&quot; &quot;allUsers&quot; {
  service  = google_cloud_run_service.shiny-simple-signin.name
  location = google_cloud_run_service.shiny-simple-signin.location
  role     = &quot;roles/run.invoker&quot;
  member   = &quot;allUsers&quot;
}
</code></pre>
<p>It is convenient to print shiny app URL after the deployment, thus output value is added in outputs.tf:</p>
<pre><code>output &quot;url&quot; {
  value = google_cloud_run_service.shiny-simple-signin.status[0].url
}</code></pre>
<p>Terraform is initiated using the init command, plan command will generate the plan and apply command will push the changes of the infrastructure. After that terraform will hold state regarding your infrastructure and configuration management. Terraform uses this state to map real-world resources to the configuration, keep track of metadata, and optimize efficiency for huge infrastructures. While it is preferred to store the state centrally (e.g. GCS bucket), this was also outside of the project scope.</p>
<pre><code>terraform init
terraform plan
terraform apply</code></pre>
</div>
<div id="cloud-run" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Cloud Run<a href="project-implementation-gcp.html#cloud-run" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Cloud Run is a managed compute platform that supports the execution of containers invoked by requests or events. Since Cloud Run is serverless, it abstracts the infrastructure administration. Additionally, the serverless approach provides more fine-grained billing and can significantly reduce the cost (e.g. in case the application is not in use). With a manually created GKE cluster, the nodes and environment are always on which means that you are billed for them regardless of utilization. With Cloud Run, the service is merely available and the billing is done only for the actual consumption.</p>
<p>In our case, we have deployed two services, which are not exposed to the internet. The only traffic allow is within the project or via Load balancer. Authentication for these services are handled either via Identity Aware Proxy or within the application.</p>
<div class="figure">
<img src="img/p-cloudruninternal.PNG" alt="" />
<p class="caption">Cloud Run</p>
</div>
<p>Withing the deployed service, all the necessary metrics are tracked for enhanced monitoring. Minimum instances could be set to 0 to make the application offline when it is not in use.</p>
<div class="figure">
<img src="img/p-cloud-run.PNG" alt="" />
<p class="caption">Cloud Run</p>
</div>
</div>
<div id="gke" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> GKE<a href="project-implementation-gcp.html#gke" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Google Kubernetes Engine is a straightforward way of setting up a Kubernetes Cluster in Cloud. These clusters are fully managed by Google Site Reliability Engineers and Google ensures that your cluster is available and up-to-date. It also supports the common Docker container format and runs on Container-Optimized OS.</p>
<p>Once the Cluster is created, the deployment is similar to Cloud Run. It can be done via Google Cloud Console, GCP SDK, or integrated into any CI/CD pipeline using Jenkins, GitActions, or similar tools.</p>
<p>To enhance the security, private GKE cluster is deployed. The service is exposed via node port internally, which is later mapped as a back-end service in the load balancer configuration. This way external connectivity is only possible via Load Balancer.</p>
<div class="figure">
<img src="img/p-gke.PNG" alt="" />
<p class="caption">App deployed in GKE</p>
</div>
<p>Since Shiny Server is a stateful application, session affinity is also needed in case there are more than one active pods (which are also referred to as sticky sessions).</p>
<div class="figure">
<img src="img/gke-lb.jpg" alt="" />
<p class="caption">GKE + Load balancer</p>
</div>
<p>A part of network topology is presented there:</p>
<div class="figure">
<img src="img/gke-networkpeers.PNG" alt="" />
<p class="caption">GKE network</p>
</div>
</div>
</div>
<div id="shiny-r-applications" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Shiny R Applications<a href="project-implementation-gcp.html#shiny-r-applications" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A simple app with a login module. This module is appropriate if it is not needed to authenticate APIs in the application and only require a login form.</p>
<div class="figure">
<img src="img/p-login.gif" alt="" />
<p class="caption">Shiny - Google Sign In</p>
</div>
<p>This uses the most modern gar_shiny_* family of functions to create authentication.</p>
<pre><code>  library(shiny)
  library(googleAuthR)
  gar_set_client(activate=&quot;web&quot;, web_json = &quot;client.json&quot;, scopes = &quot;https://www.googleapis.com/auth/webmasters&quot;)
  options(googleAuthR.redirect = &#39;https://www.shinycloud.online&#39;)
  ui &lt;- fluidPage(
    titlePanel(&quot;Old Faithful Geyser Data&quot;),
    sidebarLayout(
      sidebarPanel(
        # numericInput(&quot;bins&quot;, value = 2, label = &quot;bins&quot;)
        sliderInput(&quot;bins&quot;,
                    &quot;Number of bins:&quot;,
                    min = 1,
                    max = 50,
                    value = 30)
      ),
      mainPanel(
        plotOutput(&quot;distPlot&quot;)
      )
    )
  )
  
  ## server.R
  server &lt;- function(input, output, session){
    gar_shiny_auth(session)
    output$distPlot &lt;- renderPlot({
      x    &lt;- faithful[, 2]
      bins &lt;- seq(min(x), max(x), length.out = input$bins + 1)
      hist(x, breaks = bins, col = &#39;darkgray&#39;, border = &#39;white&#39;)
    })
  }
  shinyApp(gar_shiny_ui(ui), server)</code></pre>
<p>After the authentication is completed (in this case it is possible to adjust scope, e.g. users can allow access to their analytics API or Google Drive), user will be redirected to the app. In some platforms (such as shinyapps.io or a Kubernetes cluster, as in this case), the URL you are authenticating from will not match the URL of the Docker container the script is running in. In this instance, it must be manually set in the application.</p>
<div class="figure">
<img src="img/shiny-oauth.gif" alt="" />
<p class="caption">Shiny - Google Oauth2</p>
</div>
</div>
<div id="security-measures" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Security Measures<a href="project-implementation-gcp.html#security-measures" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="load-balancing" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Load balancing<a href="project-implementation-gcp.html#load-balancing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Load balancers are managed services on GCP that distribute application traffic across many instances. An in previous example, load balancer is responsible for routing the requests from *.shinycloud.online to the internal backend endpoints (Cloud Run, GKE cluster node port).</p>
<div class="figure">
<img src="img/p-shiny-lb.PNG" alt="" />
<p class="caption">Load Balancer</p>
</div>
</div>
<div id="dns" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> DNS<a href="project-implementation-gcp.html#dns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In order to access the application from external network, it is wise to use DNS and enable the connectivity only over HTTPS protocol. This way users can trust that they are reaching correct website and data is protected via TLS encryption. DNS instance can be created using the following command:</p>
<pre><code>gcloud beta dns --project=$PROJECTID managed-zones create shinycloud-online --description=&quot;&quot; --dns-name=&quot;shinycloud.online.&quot; --visibility=&quot;public&quot; --dnssec-state=&quot;off&quot; --log-dns-queries</code></pre>
<p>After that, address (A) record is mapped to the load balancer while the Canonical Name name is added as shinycloud.online. It is possible to create subdomains (e.g. login.shinycloud.online) and map them to separate/standalone shiny applications as well.</p>
<div class="figure">
<img src="img/p-dns.PNG" alt="" />
<p class="caption">Cloud DNS</p>
</div>
</div>
<div id="certificates" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Certificates<a href="project-implementation-gcp.html#certificates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure">
<img src="img/p-certs.PNG" alt="" />
<p class="caption">Certificates signed by CA</p>
</div>
</div>
<div id="identity-aware-proxy" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> Identity aware proxy<a href="project-implementation-gcp.html#identity-aware-proxy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Identity-Aware Proxy (IAP) is a Google Cloud Platform service that intercepts web requests sent to your application, authenticates the user making the request using the Google Identity Service, and only allows the request to proceed if it originates from a user which is authorized.</p>
<p>In the following example, IAP is enabled for 2 backend services out of three via the Load Balancer. This means that user will need to authorize via IAP proxy prior to reaching the app itself.</p>
<div class="figure">
<img src="img/p-identityawareproxy.PNG" alt="" />
<p class="caption">Identity aware proxy</p>
</div>
<p>In case the user does not have the required permissions, he will be presented with the error screen.</p>
<div class="figure">
<img src="img/p-proxyerror.PNG" alt="" />
<p class="caption">Identity aware proxy - not authorized</p>
</div>
</div>
<div id="audit" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> Audit<a href="project-implementation-gcp.html#audit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Logs are ingested from Google Cloud services and stored securely with no configuration necessary. GKE workload logs are captured automatically, while VM workload logs are captured via the Ops Agent. Having all the logs stored centrally is convenient for the analytics/anomaly detection purposes discussed in previous chapters.</p>
<div class="figure">
<img src="img/p-logging.PNG" alt="" />
<p class="caption">Cloud Logging</p>
</div>
</div>
</div>
<div id="final-result" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Final result<a href="project-implementation-gcp.html#final-result" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="figure">
<img src="img/arch.drawio.png" alt="" />
<p class="caption">Shiny Analytics Hub - Architecture</p>
</div>
<ul>
<li><a href="https://shinycloud.online/" class="uri">https://shinycloud.online/</a> - main public app (only Google Sign In)</li>
<li><a href="https://login.shinycloud.online/" class="uri">https://login.shinycloud.online/</a> - private app (Google OAuth + identity aware proxy)</li>
<li><a href="https://gke.shinycloud.online/" class="uri">https://gke.shinycloud.online/</a> - scalable app (Identity Aware Proxy)</li>
<li><a href="https://_____.shinycloud.online/" class="uri">https://_____.shinycloud.online/</a> - any new app, depending on the security and scalability requirements</li>
</ul>
<pre><code>All apps will be terminated on 2022-06-19</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="project-scope.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CloudTechnologies.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
